export class List extends HTMLElement {

  set data(list) {
    this.render(list)
  }

  constructor() {
    super()
  }

  render(list) {  
    this.innerHTML = `
      <table>
        <thead>
          ${ this.renderHead(list) }
        </thead>
        <tbody>
          ${ this.renderBody(list) }
        </tbody>
      </table>
    `
    this.updated()
  }

  updated() {
    this.querySelectorAll('.btn-edit').forEach((btn) => {
      btn.addEventListener('click', (event) => {
        this.classList.toggle('editmode')
      })
    })
    this.querySelectorAll('.btn-del').forEach((btn) => {
      btn.addEventListener('click', (event) => {
        event.stopPropagation()
        this.dispatchEvent(new CustomEvent('tracker:delete', {detail: {key: btn.dataset.item}, bubbles: true}))
      })
    })
  }

  renderHead(list) {
    let markup = '<tr>'
    for (const prop in list[0]) {
      markup += `<th>${ prop }</th>`
    }
    markup += `
      <th>
        <button title="Edit mode" class="btn-edit edit-on">
          <svg class="icon-light" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M200-200h50.461l409.463-409.463-50.461-50.461L200-250.461V-200Zm-23.845 59.999q-15.365 0-25.759-10.395-10.395-10.394-10.395-25.759v-69.306q0-14.632 5.616-27.893 5.615-13.26 15.461-23.106l506.539-506.308q9.073-8.241 20.036-12.736 10.963-4.495 22.993-4.495 12.029 0 23.307 4.27 11.277 4.269 19.969 13.576l48.846 49.461q9.308 8.692 13.269 20.004 3.962 11.311 3.962 22.622 0 12.065-4.121 23.028-4.12 10.964-13.11 20.037L296.46-161.078q-9.846 9.846-23.106 15.461-13.261 5.616-27.893 5.616h-69.306Zm584.23-570.153-50.231-50.231 50.231 50.231Zm-126.134 75.903-24.788-25.673 50.461 50.461-25.673-24.788Z"/></svg>
        </button>
        <button title="Leave edit mode" class="btn-edit edit-off">
          <svg class="icon-light" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="m802.768-667.001-177.001 176q-8.307 8.308-20.576 8.808t-21.576-8.808q-8.693-8.692-8.693-21.076t8.693-21.077l76.309-76.309-50.461-50.461-76.309 76.309q-8.308 8.308-20.885 8.5-12.576.193-21.268-8.5-8.692-8.692-8.5-21.076.192-12.384 8.5-21.076l176.616-177.001q8.923-8.923 19.961-13.077 11.038-4.154 23.192-4.154 11.769 0 23.114 4.27 11.346 4.269 20.038 13.576l48.846 49.461q9.308 8.692 13.269 20.038 3.962 11.346 3.962 22.884 0 11.769-4.154 22.807-4.154 11.039-13.077 19.962ZM200-200h50.461L462.77-412.309l-24.923-25.538-25.538-24.923L200-250.461V-200Zm570.154 94.46L505.538-369.156 296.46-160.694q-9.846 9.846-23.192 15.27-13.346 5.423-27.807 5.423h-69.306q-15.461 0-25.807-10.347-10.347-10.346-10.347-25.807v-68.69q0-14.462 5.423-27.808 5.424-13.346 15.27-23.192l209.077-209.078L105.54-770.154q-8.923-8.923-8.808-20.884.116-11.962 9.423-21.269 9.308-9.308 21.384-9.308 12.077 0 21.385 9.308l663.998 663.999q8.923 8.923 8.808 21.192-.115 12.268-9.423 21.576-9.307 9.308-21.076 9.308t-21.077-9.308Zm-9.769-604.614-50.231-50.231 50.231 50.231Zm-150.922 50.23 50.461 50.461-50.461-50.461ZM437.847-437.847l-25.538-24.923 50.461 50.461-24.923-25.538Z"/></svg>
        </button>
      </th>
      </tr>
    `
    return markup
  }

  renderBody(list) {
    let markup = ''
    list.forEach((listItem) => {
      markup += this.renderBodyRow(listItem)
    })
    return markup
  }

  renderBodyRow(item) {
    let markup = `<tr data-item="${ item.id }">`
    for (const prop in item) {
      markup += `<td>${ item[prop] }</td>`
    }
    markup += `
      <td>
        <button class="btn-del" data-item="${ item.id }">
        <svg class="icon-light" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M292.309-140.001q-29.827 0-51.067-21.241-21.241-21.24-21.241-51.067V-720h-10q-12.75 0-21.375-8.629-8.625-8.628-8.625-21.384 0-12.755 8.625-21.37 8.625-8.616 21.375-8.616H360q0-14.692 10.346-25.038t25.038-10.346h169.232q14.692 0 25.038 10.346T600-779.999h149.999q12.75 0 21.375 8.629t8.625 21.384q0 12.756-8.625 21.371Q762.749-720 749.999-720h-10v507.691q0 29.827-21.241 51.067-21.24 21.241-51.067 21.241H292.309ZM680-720H280v507.691q0 5.385 3.462 8.847 3.462 3.462 8.847 3.462h375.382q5.385 0 8.847-3.462 3.462-3.462 3.462-8.847V-720ZM406.168-280q12.755 0 21.37-8.625 8.616-8.625 8.616-21.374v-300.002q0-12.749-8.629-21.374Q418.896-640 406.141-640q-12.756 0-21.371 8.625-8.615 8.625-8.615 21.374v300.002q0 12.749 8.629 21.374Q393.412-280 406.168-280Zm147.691 0q12.756 0 21.371-8.625 8.615-8.625 8.615-21.374v-300.002q0-12.749-8.629-21.374Q566.588-640 553.832-640q-12.755 0-21.37 8.625-8.616 8.625-8.616 21.374v300.002q0 12.749 8.629 21.374Q541.104-280 553.859-280ZM280-720v520-520Z"/></svg>
        </button>
      </td>
      </tr>
    `
    return markup
  }
}